{{ $deities := .Site.Data.divinites }}

<!-- Page-specific styles -->
<style>
    /* Styles spécifiques à la page des divinités */
    .deities-hero {
        height: 50vh;
        min-height: 400px;
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                    url('https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80') no-repeat center center;
        background-size: cover;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: var(--text-light);
    }
    
    .deities-hero-content {
        max-width: 800px;
        padding: 0 var(--spacing-md);
    }
    
    .deities-hero-content h1 {
        font-size: 4.8rem;
        color: var(--text-light);
        margin-bottom: var(--spacing-sm);
    }
    
    .deities-hero-content p {
        font-size: 2rem;
        margin-bottom: var(--spacing-md);
    }
    
    .deities-overview {
        padding: var(--spacing-lg) 0;
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .cosmic-map {
        text-align: center;
        margin-bottom: var(--spacing-lg);
    }
    
    .cosmic-map-container {
        position: relative;
        max-width: 800px;
        margin: 0 auto;
    }
    
    .cosmic-map img {
        width: 100%;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    
    .deity-card {
        margin-bottom: var(--spacing-md);
        background-color: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    .deity-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    }
    
    .deity-card-image {
        height: 250px;
        overflow: hidden;
    }
    
    .deity-card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.5s ease;
    }
    
    .deity-card:hover .deity-card-image img {
        transform: scale(1.05);
    }
    
    .deity-card-content {
        padding: var(--spacing-md);
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }
    
    .deity-card-content h3 {
        font-size: 2.4rem;
        margin-bottom: var(--spacing-sm);
        color: var(--primary-dark);
    }
    
    .deity-domain {
        font-style: italic;
        color: var(--text-medium);
        margin-bottom: var(--spacing-sm);
        font-size: 1.6rem;
    }
    
    .deity-description {
        margin-bottom: var(--spacing-md);
        flex-grow: 1;
    }
    
    .deity-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--spacing-md);
        padding: 0 var(--spacing-md);
    }
    
    .deity-relations {
        padding: var(--spacing-lg) 0;
        background-color: var(--primary-medium);
        color: var(--text-light);
    }
    
    .relations-diagram {
        max-width: 1000px;
        margin: 0 auto;
        padding: var(--spacing-md);
        position: relative;
        min-height: 500px;
    }
    
    .relation-line {
        position: absolute;
        height: 2px;
        background-color: var(--accent-gold);
        transform-origin: 0 0;
    }
    
    .relation-positive {
        background-color: var(--accent-blue);
    }
    
    .relation-negative {
        background-color: var(--accent-red);
    }
    
    .relation-neutral {
        background-color: var(--accent-gold);
    }
    
    .relation-label {
        position: absolute;
        background-color: var(--primary-dark);
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-size: 1.2rem;
        white-space: nowrap;
    }
</style>

<section class="deities-hero">
    <div class="deities-hero-content">
        <h1>{{ .Title }}</h1>
        <p>{{ .Description | default "Découvrez les sept divinités puissantes qui règnent sur Everos" }}</p>
    </div>
</section>

<section class="deities-overview">
    <div class="pantheon-intro">
        <h2 class="section-title">Le Panthéon Divin</h2>
        {{ if .Content }}
        <div class="section-description">
            {{ .Content }}
        </div>
        {{ else }}
        <p class="section-description">Sept divinités puissantes règnent sur Everos, chacune maîtresse de son propre continent et de ses domaines spécifiques. Leurs influences façonnent non seulement la géographie mais aussi la culture, la magie et le destin de tous les êtres vivants.</p>
        {{ end }}
        <br>
        
        <div class="deity-grid">
            {{ range $deities }}
            <!-- {{ .name }} -->
            <div class="deity-card">
                <div class="deity-card-image">
                    <img src="{{ .image }}" alt="{{ .name }}" loading="lazy">
                </div>
                <div class="deity-card-content">
                    <h3>{{ .name }}</h3>
                    <div class="deity-domain">{{ .domain }}</div>
                    <div class="deity-description">
                        <p>{{ .short_description }}</p>
                    </div>
                    <a href="{{ printf "/pages/deities/%s/" .slug | relURL }}" class="btn">Découvrir</a>
                </div>
            </div>
            {{ end }}
        </div>
    </div>
</section>

<section class="deity-relations">
    <h2 class="section-title" style="color:white;">Relations Divines</h2>
    
    <div class="relations-diagram" id="relations-diagram">
        <!-- Les relations seront générées dynamiquement par JavaScript -->
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Données des divinités depuis Hugo
    const deities = [
        {{ range $index, $deity := $deities }}
        {{ if $index }},{{ end }}
        {
            name: "{{ .name }}",
            slug: "{{ .slug }}",
            image: "{{ .image }}",
            colors: {
                primary: "{{ .colors.primary }}",
                secondary: "{{ .colors.secondary }}",
                accent: "{{ .colors.accent }}",
                text: "{{ .colors.text }}",
                light: "{{ .colors.light }}"
            }
        }
        {{ end }}
    ];

    // Relations entre les divinités - ces données pourraient aussi venir du YAML
    const relations = [
        { from: 'Obsidienne', to: 'Mantha', type: 'negative', description: 'Conflit élémentaire' },
        { from: 'Obsidienne', to: 'Eromnia', type: 'neutral', description: 'Équilibre tendu' },
        { from: 'Mantha', to: 'Labir', type: 'negative', description: 'Territoires disputés' },
        { from: 'Mantha', to: 'Hisangarde', type: 'positive', description: 'Alliance naturelle' },
        { from: 'Labir', to: 'Light', type: 'positive', description: 'Quête de connaissance' },
        { from: 'Hisangarde', to: 'Elzeryn', type: 'neutral', description: 'Respect distant' },
        { from: 'Light', to: 'Eromnia', type: 'positive', description: 'Harmonie cosmique' },
        { from: 'Elzeryn', to: 'Obsidienne', type: 'negative', description: 'Opposition primordiale' }
    ];
    
    const diagramContainer = document.getElementById('relations-diagram');
    
    // Positions approximatives des divinités en cercle
    const positions = {
        'Obsidienne': { x: 150, y: 150 },
        'Mantha': { x: 350, y: 100 },
        'Labir': { x: 500, y: 200 },
        'Hisangarde': { x: 500, y: 400 },
        'Eromnia': { x: 350, y: 500 },
        'Light': { x: 150, y: 400 },
        'Elzeryn': { x: 100, y: 300 }
    };
    
    // Créer des cercles pour représenter les divinités
    deities.forEach(deity => {
        if (!positions[deity.name]) return;
        
        const deityElement = document.createElement('div');
        deityElement.classList.add('deity-node');
        deityElement.style.position = 'absolute';
        deityElement.style.left = positions[deity.name].x + 'px';
        deityElement.style.top = positions[deity.name].y + 'px';
        deityElement.style.width = '70px';
        deityElement.style.height = '70px';
        deityElement.style.borderRadius = '50%';
        deityElement.style.backgroundSize = 'cover';
        deityElement.style.backgroundImage = `url('${deity.image}')`;
        deityElement.style.boxShadow = '0 0 10px rgba(0, 0, 0, 0.5)';
        deityElement.style.border = `2px solid ${deity.colors.accent}`;
        deityElement.style.zIndex = '2';
        
        // Nom de la divinité
        const nameElement = document.createElement('div');
        nameElement.textContent = deity.name;
        nameElement.style.position = 'absolute';
        nameElement.style.width = '100px';
        nameElement.style.textAlign = 'center';
        nameElement.style.left = '-15px';
        nameElement.style.bottom = '-30px';
        nameElement.style.fontWeight = 'bold';
        nameElement.style.textShadow = '0 0 5px rgba(0, 0, 0, 0.5)';
        nameElement.style.color = 'var(--text-light)';
        
        deityElement.appendChild(nameElement);
        diagramContainer.appendChild(deityElement);
    });
    
    // Dessiner les lignes de relation
    relations.forEach(relation => {
        const fromPos = positions[relation.from];
        const toPos = positions[relation.to];
        
        if (!fromPos || !toPos) return;
        
        const dx = toPos.x - fromPos.x;
        const dy = toPos.y - fromPos.y;
        const length = Math.sqrt(dx * dx + dy * dy);
        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
        
        const lineElement = document.createElement('div');
        lineElement.classList.add('relation-line');
        lineElement.classList.add(`relation-${relation.type}`);
        lineElement.style.width = (length - 70) + 'px';
        lineElement.style.left = (fromPos.x + 35) + 'px';
        lineElement.style.top = (fromPos.y + 35) + 'px';
        lineElement.style.transform = `rotate(${angle}deg)`;
        lineElement.style.transformOrigin = '0 0';
        
        // Label de la relation
        const labelElement = document.createElement('div');
        labelElement.classList.add('relation-label');
        labelElement.textContent = relation.description;
        
        // Positionner le label au milieu de la ligne
        const midX = fromPos.x + dx / 2;
        const midY = fromPos.y + dy / 2;
        labelElement.style.left = midX + 'px';
        labelElement.style.top = midY + 'px';
        labelElement.style.transform = 'translate(-50%, -50%)';
        
        diagramContainer.appendChild(lineElement);
        diagramContainer.appendChild(labelElement);
    });
});
</script>